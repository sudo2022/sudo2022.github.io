# 一、概念
* Aria2是一个命令行下轻量级、多协议、多来源的下载工具（支持 HTTP/HTTPS、FTP、BitTorrent、Metalink），内建XML-RPC和JSON-RPC接口。在有权限的情况下，我们可以使用RPC接口来操作aria2来下载文件，将文件下载至任意目录，造成一个任意文件写入漏洞。
* 简单点说Aria2就是一个跨平台的，带有界面的下载器，这里举个例子，例如我们经常使用的`wget`命令一样
* Aria2任意文件写入漏洞

# 二、影响版本
* 6800端口，存在/jsonrpc文件时

# 三、漏洞环境搭建
* 这里使用的`vulhub`线下环境搭建：
```
root@wq:/home/wq/vulhub-master/aria2/rce# pwd
/home/wq/vulhub-master/aria2/rce
root@wq:/home/wq/vulhub-master/aria2/rce# ls
1.png  2.png  3.png  docker-compose.yml  README.md  README.zh-cn.md
root@wq:/home/wq/vulhub-master/aria2/rce# docker-compose up -d
root@wq:/home/wq/vulhub-master/aria2/rce# docker ps
CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS                                       NAMES
23a891613b7e   vulhub/aria2:1.18.8   "/bin/sh -c 'set -ex…"   4 minutes ago   Up 4 minutes   0.0.0.0:6800->6800/tcp, :::6800->6800/tcp   rce_aria2_1
```
* 这里由于是在我本地的环境，所以就不建议使用在线的`http://binux.github.io/yaaw/demo/`方式进行上传下载了，这里我在本地的`chrome`浏览器中安装一个插件，大家也可以在谷歌的应用市场自行搜索`YAAW`然后自行安装
![图 1](.images/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/IMG_20220117-184823765.png)  
* 安装后本地浏览器插件后，我们需要进行一些下载配置：
![图 4](.images/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/IMG_20220117-185615009.png)  
* 另外我在外网的服务器，开启了一个`http`下载的服务，并可以下载一些文件。
![图 2](.images/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/IMG_20220117-185336481.png)  
![图 3](.images/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/IMG_20220117-185432769.png)  
* 环境搭建完成后进行测试，我们下使用这个插件进行下载文件。`http://xxx.xxx.xxx.xxx/test.txt`,点击`add`
![图 6](.images/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/IMG_20220117-190040363.png)  
![图 7](.images/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/IMG_20220117-190240074.png)  
* 下载成功后，我们进入自己的靶机内去查看文件是否存在。若果存在则表示上传成功,这里我们主要是为了验证靶场的环境，并不是实际的要去上传漏洞
```
root@wq:/home/wq# docker ps 
CONTAINER ID   IMAGE                 COMMAND                  CREATED             STATUS             PORTS                                       NAMES
23a891613b7e   vulhub/aria2:1.18.8   "/bin/sh -c 'set -ex…"   About an hour ago   Up About an hour   0.0.0.0:6800->6800/tcp, :::6800->6800/tcp   rce_aria2_1
root@wq:/home/wq# docker exec -it 23a891613b7e /bin/bash
root@23a891613b7e:/etc/cron.d# pwd
/etc/cron.d
root@23a891613b7e:/etc/cron.d# ls
242ee42d66076d838555cacf0c688ee83575144c.torrent  test	test.1	test.2
root@23a891613b7e:/etc/cron.d# 
```

# 四、漏洞复现过程
* 漏洞发现过程：
    * 我们使用`nmap`进行服务扫描，判断是否目标开启了`aria2`服务
    ![图 8](.images/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/IMG_20220117-191149135.png)  
    * 既然服务是一个`aria2`我们就尝试上述过程，在自己可以下载的服务器上下载一个shell脚本到服务器
    * 问题：下载的执行脚本没有在目标机器中进行执行，但是确实已经在服务器中发现了下载的文件，关于Linux计划任务出现的问题，还有待研究



# 总结
* 这里漏洞是比较有意思的一个漏洞，如果服务端使用`aria2`这种服务，我们在客户端配置完成`aria2`地址后，在下载一些文件时会发现，文件会下载至服务器本地，并且可以指定目录